

db.posts.aggregate([
    {"$match": {"PostTypeId":"1"}},
    {"$project": {
                    "Id": 1,
                    "Title": 1,
                    "CreationDate": 1,
                    "Score": 1,
                    "AnswerCount": 1,
                    "terms": {  
                                "$concatArrays": [

                                            "$terms",
                                            {"$split": [{"$substr": [{"$toLower": "$Tags"}, 1, {"$subtract": [{"$strLenCP": "$Tags"}, 2]}]},"><"]}

                                            ]
                                }
                    }
    },
    {"$match": {"terms": {"$in": kwList}}},
    {"$unwind": "$terms"},
    {"$match": {"terms": {"$in": kwList}}},
    {"$group": {"_id": "$Id",
                "Title": {"$first": "$Title"},
                "CreationDate": {"$first": "$CreationDate"},
                "Score": {"$first": "$Score"},
                "AnswerCount": {"$first": "$AnswerCount"},
                "match": {"$sum": 1}}},
    {"$sort": {"match": -1}}
])





                                "$split": [{"$substr": [
                                                    {"$toLower": "$Tags"},
                                                    1,
                                                    {"$subtract": [{"$strLenCP": "$Tags"}, 2]}
                                                ]
                                            },
                                            "><"]
 
